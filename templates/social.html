{% extends "layout.html" %}
{% block title %}Social • FinPulse{% endblock %}
{% block content %}
  <div class="d-flex align-items-center justify-content-between mb-3 flex-wrap gap-2">
    <div>
      <h1 class="h4 mb-1">Social Intelligence</h1>
      <p class="text-muted mb-0">Net sentiment, conviction, and flow for every tracked cashtag.</p>
    </div>
    <a href="#" class="btn btn-sm btn-outline-secondary" id="refresh-sentiment">Refresh snapshot</a>
  </div>

  <section class="social-hero mb-4">
    <div class="card shadow-sm border-0 overflow-hidden">
      <div class="card-body p-4 p-lg-5 d-flex flex-column flex-lg-row align-items-start align-items-lg-center gap-4">
        <div class="flex-grow-1">
          <div class="badge bg-success-subtle text-success-emphasis mb-3">Twitter API live</div>
          <h2 class="h4 mb-3">Direct cashtag signal from X</h2>
          <p class="text-muted mb-4">
            Signal cards now hydrate straight from the official Twitter API so you can react the moment a cashtag narrative heats up.
            Every fetch pairs the live feed with TradingView pricing to keep the sentiment vs. price story in sync.
          </p>
          <ul class="social-hero-roadmap list-unstyled mb-0">
            <li><span>Cashtag sentiment</span>Net scores update as each Twitter API pull lands.</li>
            <li><span>Engagement tiers</span>Spot when high-signal desks or influencers move the crowd.</li>
            <li><span>Streaming handles</span>Wire any desk/analyst handle into the API client for instant context.</li>
          </ul>
        </div>
        <div class="social-hero-meta">
          <div class="meta-block">
            <span class="meta-label">Handles configured</span>
            <strong>{{ handles|length if handles else 0 }}</strong>
            <small class="text-muted">SOCIAL_TWITTER_ACCOUNTS</small>
          </div>
          <div class="meta-block">
            <span class="meta-label">Primary API handle</span>
            <strong>@{{ primary_handle or "not-set" }}</strong>
            <small class="text-muted">SOCIAL_TWITTER_PRIMARY_USER</small>
          </div>
          <div class="meta-block">
            <span class="meta-label">Update cadence</span>
            <strong>~15 min</strong>
            <small class="text-muted">`flask ingest-social`</small>
          </div>
          {% if handles %}
            <div class="meta-handles">
              {% for handle in handles[:5] %}
                <span class="handle-pill">@{{ handle }}</span>
              {% endfor %}
              {% if handles|length > 5 %}
                <span class="handle-pill muted">+{{ handles|length - 5 }} more</span>
              {% endif %}
            </div>
          {% else %}
            <div class="meta-handles text-muted small">
              Add handles via <code>SOCIAL_TWITTER_ACCOUNTS</code> to preview stream targets.
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </section>

  <section class="social-metrics mb-4">
    <div class="row g-3">
      <div class="col-12 col-md-6 col-xl-3">
        <div class="card shadow-sm h-100 metric-card">
          <div class="card-body">
            <div class="text-muted text-uppercase small fw-semibold mb-2">Symbols tracked</div>
            <div class="display-6 fw-semibold mb-1" id="metric-symbols">—</div>
            <p class="text-muted small mb-0">Live coverage universe from the latest ingest.</p>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-6 col-xl-3">
        <div class="card shadow-sm h-100 metric-card">
          <div class="card-body">
            <div class="text-muted text-uppercase small fw-semibold mb-2">Total posts</div>
            <div class="display-6 fw-semibold mb-1" id="metric-posts">—</div>
            <p class="text-muted small mb-0">Messages analysed across configured sources.</p>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-6 col-xl-3">
        <div class="card shadow-sm h-100 metric-card">
          <div class="card-body">
            <div class="text-muted text-uppercase small fw-semibold mb-2">Bullish share</div>
            <div class="display-6 fw-semibold mb-1" id="metric-bullish">—</div>
            <p class="text-muted small mb-0">Portion of cashtag chatter skewing positive.</p>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-6 col-xl-3">
        <div class="card shadow-sm h-100 metric-card">
          <div class="card-body">
            <div class="text-muted text-uppercase small fw-semibold mb-2">Avg. net score</div>
            <div class="display-6 fw-semibold mb-1" id="metric-net-score">—</div>
            <p class="text-muted small mb-0">Composite conviction across tracked symbols.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div class="row g-3 social-grid">
    <div class="col-12 col-xl-4">
      <div class="card shadow-sm h-100 social-list-card">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
            <div>
              <h2 class="h6 mb-1">Symbol stack</h2>
              <p class="text-muted small mb-0">Ranked by current net score.</p>
            </div>
            <span class="text-muted small" id="sentiment-list-count"></span>
          </div>
          <div id="sentiment-list" class="social-symbol-list"></div>
        </div>
      </div>
    </div>
    <div class="col-12 col-xl-8">
      <div id="sentiment-detail" class="social-detail"></div>
      <div id="sentiment-empty" class="alert alert-light border d-none">
        No sentiment data found. Run <code>flask --app app ingest-social</code> to seed the dataset.
      </div>
    </div>
  </div>

  <section class="social-stream card shadow-sm border-0 mt-4">
    <div class="card-body d-flex flex-column flex-lg-row align-items-start gap-4">
          <div class="flex-grow-1">
            <h2 class="h6 text-uppercase text-muted mb-2">X stream staging</h2>
            <p class="mb-0 text-muted">
              This panel will light up with live posts as soon as the Twitter API bearer token is set and the ingest job runs.
              Wire up <code>SOCIAL_TWITTER_BEARER_TOKEN</code> and schedule <code>flask ingest-social</code> to keep the cache fresh.
            </p>
          </div>
          <div class="stream-meta text-end">
            <div class="meta-label text-muted text-uppercase small">Primary handle</div>
            <div class="fs-5 fw-semibold mb-1">@{{ primary_handle or "pending" }}</div>
            <div class="text-muted small">Switch via <code>SOCIAL_TWITTER_PRIMARY_USER</code>.</div>
          </div>
        </div>
      </section>
{% endblock %}

{% block scripts %}
  <script src="https://s3.tradingview.com/tv.js" defer></script>
  <script src="{{ url_for('static', filename='js/social-summary.js') }}"></script>
{% endblock %}
