{% extends "layout.html" %}

{% block title %}Macro Trends Â· FinPulse{% endblock %}

{% block content %}
  <section class="macro-hero mb-5">
    <div class="macro-hero-head">
      <div>
        <span class="macro-kicker text-uppercase">Macro dashboard</span>
        <h1 class="display-6 mb-2">Macro Trends</h1>
        <p class="macro-hero-subtitle">Stay on top of growth, inflation, and activity signals with annotated charts and curated context.</p>
      </div>
      {% if macro_updated %}
        <div class="macro-stamp">
          <span class="macro-stamp-label">Last updated</span>
          <span class="macro-stamp-value">{{ macro_updated }}</span>
        </div>
      {% endif %}
    </div>
    <p class="macro-hero-copy">Tabs group the core macro pillars. Each panel surfaces the latest datapoint, delta annotations, and an analyst callout so teams can brief in minutes.</p>
  </section>

  {% if macro_categories %}
    <section class="macro-tabs">
      <div class="macro-tabs-shell">
        <ul class="macro-tablist nav nav-pills" id="macroTab" role="tablist">
          {% for category in macro_categories %}
            {% set primary = category.metrics | first %}
            <li class="nav-item" role="presentation">
              <button class="macro-tab-link {% if loop.first %}active{% endif %}" id="macro-tab-{{ category.id }}"
                      data-bs-toggle="tab" data-bs-target="#macro-pane-{{ category.id }}" type="button" role="tab"
                      aria-controls="macro-pane-{{ category.id }}" aria-selected="{{ 'true' if loop.first else 'false' }}"
                      data-category="{{ category.id }}">
                <span class="macro-tab-title">{{ category.title }}</span>
                {% if primary %}
                  <span class="macro-tab-subtext">{{ primary.summary or primary.detail or "Awaiting latest insight." }}</span>
                {% endif %}
              </button>
            </li>
          {% endfor %}
        </ul>

        <div class="macro-tab-content tab-content">
          {% for category in macro_categories %}
            {% set primary = category.metrics | first %}
            <div class="tab-pane fade {% if loop.first %}show active{% endif %}" id="macro-pane-{{ category.id }}" role="tabpanel" aria-labelledby="macro-tab-{{ category.id }}">
              <section class="macro-category" data-category="{{ category.id }}" id="{{ category.id }}">
                <header class="macro-category-header">
                  <div>
                    <h2 class="macro-category-title">{{ category.title }}</h2>
                    {% if primary %}
                      <p class="macro-category-lede">{{ primary.detail or primary.summary or "Latest update pending." }}</p>
                    {% endif %}
                  </div>
                  <a class="btn btn-outline-light btn-sm" href="{{ url_for('web.index') }}#macro-trends">Back to overview</a>
                </header>

                <div class="macro-metric-grid">
                  {% for metric in category.metrics %}
                    {% set insight = metric.insights or {} %}
                    <article class="macro-metric-card" id="{{ category.id }}-{{ metric.id }}" data-category="{{ category.id }}">
                      <div class="macro-metric-head">
                        <div>
                          <span class="macro-metric-name">{{ metric.name }}</span>
                          {% if metric.summary %}
                            <p class="macro-metric-summary">{{ metric.summary }}</p>
                          {% endif %}
                        </div>
                        {% if metric.delta %}
                          <span class="macro-metric-delta">{{ metric.delta }}</span>
                        {% endif %}
                      </div>

                      <div class="macro-metric-body">
                        <div class="macro-metric-chart">
                          {% if metric.history %}
                            <canvas class="macro-chart" data-history='{{ metric.history | tojson | safe }}' data-chart-height="220"></canvas>
                          {% else %}
                            <div class="macro-chart-empty">Awaiting time series</div>
                          {% endif %}
                        </div>
                        <div class="macro-metric-context">
                          {% if metric.detail %}
                            <div class="macro-callout">
                              <span class="macro-callout-label">Why it matters</span>
                              <p class="macro-callout-text">{{ metric.detail }}</p>
                            </div>
                          {% endif %}
                          {% if insight %}
                            <div class="macro-callout">
                              <span class="macro-callout-label">Analyst lens</span>
                              {% if insight.overview %}
                                <p class="macro-callout-text">{{ insight.overview }}</p>
                              {% endif %}
                              <div class="macro-insight-grid">
                                {% if insight.high %}
                                  <div class="macro-insight-item">
                                    <span class="macro-insight-label">Higher readings</span>
                                    <p class="macro-insight-note">{{ insight.high }}</p>
                                  </div>
                                {% endif %}
                                {% if insight.low %}
                                  <div class="macro-insight-item">
                                    <span class="macro-insight-label">Lower readings</span>
                                    <p class="macro-insight-note">{{ insight.low }}</p>
                                  </div>
                                {% endif %}
                                {% if insight.range %}
                                  <div class="macro-insight-item">
                                    <span class="macro-insight-label">Typical range</span>
                                    <p class="macro-insight-note">{{ insight.range }}</p>
                                  </div>
                                {% endif %}
                              </div>
                            </div>
                          {% endif %}
                        </div>
                      </div>
                    </article>
                  {% endfor %}
                </div>
              </section>
            </div>
          {% endfor %}
        </div>
      </div>
    </section>
  {% else %}
    <div class="alert alert-light border">Macro data has not been ingested yet. Run <code>flask --app app ingest-news</code> to populate the dashboard.</div>
  {% endif %}
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script src="{{ url_for('static', filename='js/macro-charts.js') }}"></script>
  <script src="{{ url_for('static', filename='js/macro-insights.js') }}"></script>
{% endblock %}
