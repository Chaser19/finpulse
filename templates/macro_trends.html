{% extends "layout.html" %}

{% block title %}Macro Trends · FinPulse{% endblock %}

{% block content %}
  <div class="d-flex flex-wrap align-items-center justify-content-between mb-4 gap-2">
    <div>
      <h1 class="display-6 mb-1">Macro Trends</h1>
      <p class="text-white-50 mb-0">Interactive dashboard tracking employment, inflation, and economic activity indicators.</p>
    </div>
    {% if macro_updated %}
      <span class="text-muted small">Updated {{ macro_updated }}</span>
    {% endif %}
  </div>

  {% if macro_categories %}
    <div class="macro-overview-grid mb-4">
      {% for category in macro_categories %}
        {% set primary = category.metrics | first %}
        <article class="macro-overview-card">
          <div class="macro-overview-head">
            <h2 class="h6 text-uppercase text-muted mb-1">{{ category.title }}</h2>
            <a class="macro-overview-link text-white-50 small" href="#{{ category.id }}">Jump to detail</a>
          </div>
          <p class="macro-overview-tagline text-white-75 mb-1">
            {% if primary %}
              {{ primary.summary or primary.detail or "View the dashboard for full context." }}
            {% else %}
              Waiting on latest data…
            {% endif %}
          </p>
          {% if primary and primary.delta %}
            <span class="macro-overview-delta text-info small">{{ primary.delta }}</span>
          {% endif %}
        </article>
      {% endfor %}
    </div>
  {% endif %}

  <div class="row g-3">
    {% for category in macro_categories %}
      <section id="{{ category.id }}" class="col-12">
        <div class="card shadow-sm h-100">
          <div class="card-body">
            <div class="macro-category-header d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3">
              <div>
                <h2 class="h5 mb-1">{{ category.title }}</h2>
                {% set primary = category.metrics | first %}
                <p class="text-white-50 mb-0">
                  {% if primary %}
                    {{ primary.detail or primary.summary or "Latest update pending." }}
                  {% else %}
                    Latest update pending.
                  {% endif %}
                </p>
              </div>
              <a class="btn btn-sm btn-outline-light" href="{{ url_for('web.index') }}#macro-trends">Back to overview</a>
            </div>
            <div class="macro-detail-grid">
              {% for metric in category.metrics %}
                {% set insight = metric.insights or {} %}
                <details id="{{ category.id }}-{{ metric.id }}" class="macro-detail-card">
                  <summary class="macro-detail-summary">
                    <div class="macro-detail-summary-text">
                      <span class="macro-detail-name">{{ metric.name }}</span>
                      <span class="macro-detail-highlight">
                        {{ metric.summary or metric.detail or "View detail" }}
                      </span>
                    </div>
                    <div class="macro-detail-summary-meta">
                      {% if metric.delta %}
                        <span class="macro-detail-delta">{{ metric.delta }}</span>
                      {% endif %}
                      <span class="macro-detail-chevron" aria-hidden="true">▾</span>
                    </div>
                  </summary>
                  <div class="macro-detail-content">
                    {% if metric.detail %}
                      <p class="text-white-75">{{ metric.detail }}</p>
                    {% endif %}
                    {% if metric.history %}
                      <div class="macro-detail-chart">
                        <canvas class="macro-chart" data-history='{{ metric.history | tojson | safe }}' data-chart-height="160"></canvas>
                      </div>
                    {% endif %}
                    {% if insight %}
                      <div class="macro-insight-card">
                        {% if insight.overview %}
                          <p class="text-white-75 mb-3">{{ insight.overview }}</p>
                        {% endif %}
                        <div class="macro-insight-meta text-white-75 small">
                          {% if insight.high %}
                            <div class="macro-insight-point mb-3">
                              <span class="macro-insight-label text-uppercase text-primary-emphasis">Higher readings</span>
                              <p class="mb-0">{{ insight.high }}</p>
                            </div>
                          {% endif %}
                          {% if insight.low %}
                            <div class="macro-insight-point mb-3">
                              <span class="macro-insight-label text-uppercase text-info">Lower readings</span>
                              <p class="mb-0">{{ insight.low }}</p>
                            </div>
                          {% endif %}
                          {% if insight.range %}
                            <div class="macro-insight-point">
                              <span class="macro-insight-label text-uppercase text-white-50">Typical range</span>
                              <p class="mb-0">{{ insight.range }}</p>
                            </div>
                          {% endif %}
                        </div>
                      </div>
                    {% endif %}
                  </div>
                </details>
              {% endfor %}
            </div>
          </div>
        </div>
      </section>
    {% endfor %}
  </div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script src="{{ url_for('static', filename='js/macro-charts.js') }}"></script>
  <script src="{{ url_for('static', filename='js/macro-insights.js') }}"></script>
{% endblock %}
